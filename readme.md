# HDR Avatar Blocker

A lightweight solution to disable the HDR effect on small images like avatars, preventing them from appearing overly bright or washed out. Available as both a Chrome extension and a User.js script.

## Problem

Some monitors automatically enable HDR mode when HDR content is detected. While this is great for photos and videos, it can make small, everyday images (like icons, logos, and especially avatars) uncomfortably bright. This extension solves that by applying a simple CSS filter to neutralize the HDR effect on images smaller than a user-defined size (defaulting to 200x200 pixels).

## Features

-   Automatically disables HDR for images smaller than a customizable size.
-   Does not affect larger images or videos.
-   Works on all websites.
-   Settings are configurable via an options page.
-   Extremely lightweight and fast, running before images even render to prevent flickering.

## How It Works

The extension injects a content script into every webpage. This script observes the page for `<img>` tags and applies the CSS style `filter: contrast(100%) saturate(100%);` to any image that is rendered smaller than the defined size threshold.

## Installation

### Option 1: Chrome Extension (Local Installation)

1. Download the source code files.
2. Open Chrome and navigate to `chrome://extensions`.
3. Enable "Developer mode" using the toggle in the top-right corner.
4. Click the "Load unpacked" button in the top-left corner.
5. Select the directory containing the source code.

### Option 2: User.js Script

Due to certain circumstances where locally loaded Chrome extensions are automatically uninstalled, we also provide a userscript installation method.

1. Install a userscript manager:
    - **Tampermonkey** (Recommended): [Chrome Web Store](https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo)
    - **Violentmonkey**: [Chrome Web Store](https://chrome.google.com/webstore/detail/violentmonkey/jinjaccalgkegednnccohejagnlnfdag)
    - **Greasemonkey** (Firefox only): [Firefox Add-ons](https://addons.mozilla.org/en-US/firefox/addon/greasemonkey/)
2. Click to install: [hdr-avatar-blocker.user.js](./hdr-avatar-blocker.user.js)
3. Configure settings through the userscript manager menu

---

# HDR 头像屏蔽器

一个轻量级的解决方案，用于禁用小尺寸图片（如头像）的 HDR 显示效果，防止它们看起来过曝或色彩失真。支持 Chrome 扩展和 User.js 用户脚本两种形式。

![令人困扰的头像举例](/assets/meiwaku_example.jpg)

## 问题背景

部分显示器在检测到 HDR 内容时会自动开启 HDR 模式。这对于观看照片和视频来说是很好的体验，但对于网页上的小图片（如图标、Logo、特别是各种圆形或方形的头像），这种效果可能会导致其亮度过高，非常刺眼。本插件通过对小于用户自定义尺寸（默认为 200x200 像素）的图片应用一层简单的 CSS 滤镜，来解决这个问题。

## 功能特性

-   自动为小于自定义尺寸的图片禁用 HDR。
-   不干涉大图片或视频的正常 HDR 显示。
-   在所有网站上生效。
-   可通过选项页面配置尺寸阈值。
-   极致轻量和高效，在图片渲染前执行，避免闪烁。

## 实现原理

此扩展会向每个网页注入一个内容脚本（`content.js`）。该脚本会监听页面中出现的 `<img>` 标签，并对任何渲染尺寸小于设定阈值的图片应用 `filter: contrast(100%) saturate(100%);` 的 CSS 样式。

## 安装方式

### 方式一：Chrome 扩展（本地安装）

1. 下载所有源代码文件。
2. 打开 Chrome 浏览器，访问 `chrome://extensions`。
3. 在页面右上角，打开"开发者模式"开关。
4. 点击左上角的"加载已解压的扩展程序"按钮。
5. 在弹出的文件选择框中，选中包含代码的文件夹。

### 方式二：User.js 用户脚本

由于某些情况下本地加载的 Chrome 扩展会被自动卸载，我们也提供了用户脚本安装方式。

1. 安装脚本管理器：
    - **Tampermonkey**（推荐）：[Chrome Web Store](https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo)
    - **Violentmonkey**：[Chrome Web Store](https://chrome.google.com/webstore/detail/violentmonkey/jinjaccalgkegednnccohejagnlnfdag)
    - **Greasemonkey**（仅限 Firefox）：[Firefox Add-ons](https://addons.mozilla.org/en-US/firefox/addon/greasemonkey/)
2. 点击安装：[hdr-avatar-blocker.user.js](./hdr-avatar-blocker.user.js)
3. 通过脚本管理器菜单配置设置

## Prompt

This plugin was generated by gemini-CLI v0.1.13. The following is the full prompt (Chinese) used:

生成此插件使用了 gemini-CLI v0.1.13，以下为使用的全部 prompt：

```
当前目录是一个空目录，请你帮我开发一个 Chrome 插件，实现 HDR 图片禁用功能。

功能：
- 禁用小图片的 HDR 显示功能
- 定义：在浏览器上渲染尺寸低于 200px x 200px 的图片即为小图片
- 不干涉大图片或视频的 HDR 显示

原理：
- 禁用 HDR 可以通过为图片添加 CSS img {filter: contrast(100%) saturate(100%);} 来实现

你需要以最小代码添加可以在本地 Chrome 浏览器测试的插件，无需其他额外内容。
```

```
运行有个问题，图片似乎会先以 HDR 加载，等待 1s 左右网页加载完毕后再被处理，请改进
```

```
非常好，请帮我撰写英、中文 readme.md，稍后我会手工发布到 github，同时完善其格式，使得其满足开源项目要求
```

This userscript was generated by cursor with claude 4 sonnet, the following is the full prompt:

生成此用户脚本使用了 cursor 和 claude 4 sonnet，以下为使用的全部 prompt：

```
将这个 chrome 扩展改为 User.js 用户脚本。
```

```
按照现有 README 的风格，将 userscript 的 README 合进去。
```